<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
    <title>产品地图</title>
    <script src="http://webapi.amap.com/maps?v=1.3&key=e7bb3a93646fc45cf3dfb2f2dc5cffa5"></script>
    <script src="http://libs.baidu.com/jquery/2.1.1/jquery.min.js"></script>
    <style>
        #container {
            width: 800px;
            height: 600px;
            margin: 20px auto;
        }
    </style>
</head>

<body>
    <div id="container"></div>
    <script>
        var cluster, markers = [];
        var data = {
            "header": {
                "tokenOperator": "",
                "tokenDevice": ""
            },
            "data": {
                "event_id": "get_product_usage_stat_by_xy",
                "param": {
                    "prodId": "1001",
                    "userId": "104"
                }
            }
        };

        $.ajax({
            url: "http://119.23.132.97/api/trace_product",
            type: "POST",
            data: data,
            cache: false,
            contentType: "application/json",
            dataType: "json",
            data: JSON.stringify(data),
            success: function (data) {
                console.log(data);

                var map = new AMap.Map("container", {
                    resizeEnable: true,
                    center: [113.93828, 22.518995], //地图中心点
                    zoom: 18 //地图缩放
                });

                for (var i = 0; i < data.data.length; i++) {
                    var sale = data.data[i].count;
                    var position = [data.data[i].longitude, data.data[i].latitude];

                    var marker = new AMap.Marker({
                        position: position,
                        icon: 'http://webapi.amap.com/theme/v1.3/markers/n/mark_b' + (sale) + '.png',
                        offset: { x: -8, y: -34 }
                    });

                    markers.push(marker);
                    marker.setMap(map);
                }


                addCluster(0);

                AMap.event.addDomListener(document.getElementById('add0'), 'click', function () {
                    addCluster(0);
                });
                AMap.event.addDomListener(document.getElementById('add1'), 'click', function () {
                    addCluster(1);
                });

                // 添加点聚合
                function addCluster(tag) {
                    if (cluster) {
                        cluster.setMap(null);
                    }

                    map.plugin(["AMap.MarkerClusterer"], function () {
                        cluster = new AMap.MarkerClusterer(map, markers);
                    });

                }


            }
        });
    </script>
</body>

</html>